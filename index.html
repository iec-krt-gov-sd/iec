<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مفوضية تشجيع الاستثمار | ولاية الخرطوم</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Tajawal -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons: FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            overflow-x: hidden;
        }

        :root {
            --primary-green: #00664F;
            --secondary-green: #4CAF50;
            --accent-gold: #C5A059;
            --dark-gray: #1F2937;
        }

        .bg-primary-green {
            background-color: var(--primary-green);
        }

        .text-primary-green {
            color: var(--primary-green);
        }

        .bg-accent-gold {
            background-color: var(--accent-gold);
        }

        .text-accent-gold {
            color: var(--accent-gold);
        }

        /* Dropdown Menu Animation */
        .group:hover .group-hover\:block {
            display: block;
            animation: fadeInMenu 0.2s ease-in-out forwards;
        }

        @keyframes fadeInMenu {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Hero Section */

        /* Hero Section - تعديل الخلفية لتطابق التصميم الجديد */
        .hero-bg {
            background: linear-gradient(135deg, #1f4d42 0%, #00664F 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-bg {
            /* صورة تعبر عن الخرطوم أو النيل */
            background-image: linear-gradient(rgba(0, 102, 79, 0.85), rgba(0, 102, 79, 0.7)), url('https://images.unsplash.com/photo-1540994968412-25e404b9015c?auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .page-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Scrollbar for Dropdowns */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #C5A059;
            border-radius: 3px;
        }

        /* Modal Styles */
        .modal {
            transition: opacity 0.25s ease;
        }

        body.modal-active {
            overflow-x: hidden;
            overflow-y: visible !important;
        }

        /* Map Specific Styles */
        #map {
            height: 70vh;
            width: 100%;
            border-radius: 0.5rem;
            z-index: 1;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 10px;
            text-align: right;
            font-family: 'Tajawal', sans-serif;
        }
        .popup-title {
            background-color: var(--primary-green);
            color: white;
            padding: 10px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 1.1em;
            margin: -1px -1px 10px -1px;
            text-align: center;
        }
        .popup-content ul {
            padding-right: 20px;
            margin: 0;
            list-style-type: circle;
        }
        .popup-content li {
            margin-bottom: 5px;
            font-size: 0.9em;
            line-height: 1.4;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <!-- Top Bar (Social & Contact) -->
    <div class="bg-primary-green text-white py-2 hidden md:block border-b border-green-800">
        <div class="container mx-auto px-4 flex justify-between items-center text-sm">
            <div class="flex items-center space-x-4 space-x-reverse">
                <span class="hover:text-accent-gold transition cursor-pointer"><i class="fas fa-phone ml-1 text-accent-gold"></i> 00249126434639</span>
                <span class="hover:text-accent-gold transition cursor-pointer"><i class="fas fa-envelope ml-1 text-accent-gold"></i>iec.krt.gov@gmail.com</span>
            </div>
            <div class="flex items-center space-x-4 space-x-reverse">
                <a href="https://x.com/IecKrt?s=20" target="_blank"
                    class="hover:text-accent-gold transition flex items-center gap-1">
                    <i class="fa-brands fa-x-twitter"></i> منصة X
                </a>
                <span class="text-gray-400">|</span>
                <a href="https://www.facebook.com/share/1N8BAEJ3fM/" target="_blank"
                    class="hover:text-accent-gold transition flex items-center gap-1">
                    <i class="fab fa-facebook-f"></i> فيسبوك
                </a>
            </div>
        </div>
    </div>

    <!-- Header / Navbar -->
    <header class="bg-white shadow-md fixed w-full z-50 top-0 md:top-9 transition-all duration-300" id="main-header">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">

           <!-- Logo Section -->
            <!-- The filename 'I.E.C Logomain.png' is used here. Ensure this file is in the same folder as index.html -->
            <div class="flex items-center gap-4 cursor-pointer" onclick="navigateTo('home')">
                <img src="I.E.C Logomain.png" onerror="this.src='IEClogofull.png'" alt="شعار المفوضية"
                    class="h-20 md:h-28 w-auto object-contain transition hover:scale-105 duration-300">

                <!-- <div class="flex flex-col">
                    <h1 class="text-xl md:text-3xl font-bold text-primary-green leading-tight">مفوضية تشجيع الاستثمار
                    </h1>
                    <h2 class="text-sm md:text-lg text-gray-600 font-medium tracking-wide">ولاية الخرطوم</h2>
                </div> -->
            </div>

            <!-- Desktop Menu -->
            <nav class="hidden xl:flex items-center gap-1 text-sm font-bold">

                <button onclick="navigateTo('home')"
                    class="nav-link text-gray-700 hover:text-primary-green hover:bg-gray-50 rounded-lg transition py-2 px-3">الرئيسية</button>

                <!-- Menu 1: Sectors -->
                <div class="relative group">
                    <button class="flex items-center text-gray-700 hover:text-primary-green hover:bg-gray-50 rounded-lg transition py-2 px-3">
                        القطاعات <i class="fas fa-chevron-down mr-1 text-xs text-accent-gold"></i>
                    </button>
                    <div class="absolute hidden group-hover:block w-72 bg-white shadow-xl rounded-b-lg border-t-4 border-accent-gold top-full right-0 max-h-96 overflow-y-auto custom-scroll"
                        id="nav-sectors-container">
                        <!-- Populated via JS -->
                    </div>
                </div>

                <!-- Menu 2: Localities -->
                <div class="relative group">
                    <button class="flex items-center text-gray-700 hover:text-primary-green hover:bg-gray-50 rounded-lg transition py-2 px-3">
                        المحليات <i class="fas fa-chevron-down mr-1 text-xs text-accent-gold"></i>
                    </button>
                    <div class="absolute hidden group-hover:block w-72 bg-white shadow-xl rounded-b-lg border-t-4 border-accent-gold top-full right-0 max-h-96 overflow-y-auto custom-scroll"
                        id="nav-localities-container">
                        <!-- Populated via JS (Will include Map Link) -->
                    </div>
                </div>

                <!-- Menu 3: Commission Opportunities -->
                <div class="relative group">
                    <button class="flex items-center text-primary-green hover:text-accent-gold bg-green-50 rounded-lg transition py-2 px-3 border border-green-100">
                         المفوضية <i class="fas fa-chevron-down mr-1 text-xs"></i>
                    </button>
                    <div class="absolute hidden group-hover:block w-96 bg-white shadow-xl rounded-b-lg border-t-4 border-primary-green top-full right-0 max-h-96 overflow-y-auto custom-scroll"
                        id="nav-commission-container">
                        <!-- Populated via JS -->
                    </div>
                </div>

                <button onclick="navigateTo('library')"
                    class="nav-link text-gray-700 hover:text-primary-green hover:bg-gray-50 rounded-lg transition py-2 px-3">
                    المكتبة
                </button>

                <!-- Services Menu -->
                <div class="relative group">
                    <button class="flex items-center text-gray-700 hover:text-primary-green hover:bg-gray-50 rounded-lg transition py-2 px-3">
                        الخدمات <i class="fas fa-chevron-down mr-1 text-xs text-accent-gold"></i>
                    </button>
                    <div
                        class="absolute hidden group-hover:block w-48 bg-white shadow-xl rounded-b-lg border-t-4 border-accent-gold top-full right-0">
                        <button onclick="navigateTo('procedures')"
                            class="block w-full text-right px-4 py-3 text-sm text-gray-700 hover:bg-green-50 border-b transition">مرشد
                            الإجراءات</button>
                        <button onclick="navigateTo('law')"
                            class="block w-full text-right px-4 py-3 text-sm text-gray-700 hover:bg-green-50 transition">قانون
                            الاستثمار</button>
                    </div>
                </div>

                <button onclick="navigateTo('contact-page')"
                    class="bg-accent-gold text-white px-5 py-2 rounded-full hover:bg-yellow-600 transition shadow-md mr-2">
                    اتصل بنا
                </button>
            </nav>

            <!-- Mobile Toggle -->
            <button class="xl:hidden text-primary-green text-2xl focus:outline-none" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu"
            class="hidden xl:hidden bg-white border-t h-screen overflow-y-auto pb-40 fixed w-full z-40 top-[70px]">
            <div class="flex flex-col p-4 space-y-2">
                <button onclick="navigateTo('home')"
                    class="text-right font-bold text-gray-800 py-3 border-b">الرئيسية</button>

                <!-- Mobile: Sectors -->
                <div class="py-2 border-b">
                    <span class="text-primary-green text-sm mb-2 block font-bold"><i class="fas fa-layer-group ml-2"></i>تصفح حسب القطاع</span>
                    <div id="mobile-sectors-list" class="pr-4 space-y-2 border-r-2 border-gray-100 mr-1"></div>
                </div>

                <!-- Mobile: Localities -->
                <div class="py-2 border-b">
                    <span class="text-primary-green text-sm mb-2 block font-bold"><i class="fas fa-map-marked-alt ml-2"></i>تصفح حسب المحلية</span>
                    <div id="mobile-localities-list" class="pr-4 space-y-2 border-r-2 border-gray-100 mr-1">
                        <!-- Map Link for Mobile -->
                        <button onclick="navigateTo('map-page'); toggleMobileMenu(false);" 
                                class="block w-full text-right px-2 py-1 text-accent-gold font-bold hover:text-primary-green text-sm">
                            <i class="fas fa-map-marked-alt ml-1"></i> الخريطة التفاعلية
                        </button>
                    </div>
                </div>

                 <!-- Mobile: Commission Opportunities -->
                 <div class="py-2 border-b bg-green-50 -mx-4 px-8">
                    <span class="text-primary-green text-sm mb-2 block font-bold"><i class="fas fa-star ml-2"></i>المفوضية</span>
                    <div id="mobile-commission-list" class="pr-4 space-y-2 border-r-2 border-accent-gold mr-1"></div>
                </div>

                <button onclick="navigateTo('library')" class="text-right font-bold text-gray-800 py-3 border-b">مكتبة
                    المستثمر</button>
                
                <div class="py-4 flex justify-center gap-4">
                     <a href="https://x.com/IecKrt?s=20" class="text-gray-500 hover:text-black text-xl"><i class="fa-brands fa-x-twitter"></i></a>
                     <a href="https://www.facebook.com/share/1N8BAEJ3fM/" class="text-blue-600 text-xl"><i class="fab fa-facebook"></i></a>
                </div>

                <button onclick="navigateTo('contact-page')"
                    class="bg-primary-green text-white py-3 rounded mt-2 w-full shadow-lg">اتصل بنا</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow pt-24 md:pt-36">

        <!-- ==================== HOME PAGE ==================== -->
        <section id="home" class="page-section active">
            <div class="hero-bg text-white min-h-[85vh] flex items-center relative py-12">
                
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>

                <div class="container mx-auto px-4 relative z-10">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-12">
                        
                        <div class="w-full md:w-1/2 text-center md:text-right" data-aos="fade-left">
                            <span class="bg-accent-gold text-white px-4 py-1 rounded-sm text-sm font-bold mb-6 inline-block tracking-wide shadow-lg">
                                الاستثمار الأمثل للموارد
                            </span>
                            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight drop-shadow-md">
                                مفوضية تشجيع الاستثمار<br>
                                <span class="text-gray-200 text-3xl md:text-5xl font-light">ولاية الخرطوم</span>
                            </h1>
                            <p class="text-lg md:text-xl mb-10 max-w-2xl opacity-90 leading-relaxed font-light text-gray-100">
                                بوابة إلكترونية موحدة تربطك بأحدث الفرص الاستراتيجية والخدمية في الولاية، مدعومة ببيانات دقيقة وخرائط استثمارية محدثة.
                            </p>
                            
                            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse justify-center md:justify-start">
                                <button onclick="navigateTo('map-page')"
                                    class="bg-accent-gold text-white px-8 py-3 rounded font-bold hover:bg-yellow-600 transition shadow-lg flex items-center justify-center gap-2">
                                    <i class="fas fa-map-marked-alt"></i> الخريطة التفاعلية
                                </button>
                                <button onclick="showAllOpportunities()"
                                    class="bg-white text-primary-green px-8 py-3 rounded shadow-lg font-bold hover:bg-gray-100 transition transform hover:-translate-y-1">
                                    استكشف الفرص
                                </button>
                            </div>
                        </div>

                        <div class="w-full md:w-1/2" data-aos="fade-right">
                            <div class="relative rounded-xl overflow-hidden shadow-2xl border-4 border-white/20 bg-white/10 backdrop-blur-sm p-2">
                                <img src="Mainwithmap.png" 
                                     onerror="this.src='Gemini_Generated_Image_3f6z0y3f6z0y3f6z.jpg'" 
                                     alt="خريطة ولاية الخرطوم" 
                                     class="w-full h-auto rounded shadow-inner object-contain bg-[#fff8e1]">
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="bg-white py-12 relative z-20 shadow-lg border-b border-gray-100">
                <div class="container mx-auto px-4">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center divide-x divide-x-reverse divide-gray-200">
                        <div class="p-4" data-aos="fade-up" data-aos-delay="100">
                            <h3 class="text-3xl font-extrabold text-primary-green mb-1">80%</h3>
                            <p class="text-gray-600 text-sm">من النشاط الصناعي</p>
                        </div>
                        <div class="p-4" data-aos="fade-up" data-aos-delay="200">
                            <h3 class="text-3xl font-extrabold text-primary-green mb-1">1.8M</h3>
                            <p class="text-gray-600 text-sm">فدان قابل للزراعة</p>
                        </div>
                        <div class="p-4" data-aos="fade-up" data-aos-delay="300">
                            <h3 class="text-3xl font-extrabold text-primary-green mb-1">50KM</h3>
                            <p class="text-gray-600 text-sm">بعد الجيلي عن المركز</p>
                        </div>
                        <div class="p-4" data-aos="fade-up" data-aos-delay="400">
                            <h3 class="text-3xl font-extrabold text-primary-green mb-1">400K+</h3>
                            <p class="text-gray-600 text-sm">فرصة عمل متوقعة</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

            <!-- Stats -->
            <div class="bg-white py-16 relative -mt-10 z-20 rounded-t-3xl shadow-inner md:mt-0 md:rounded-none">
                <div class="container mx-auto px-4 text-center">
                    <h2 class="text-3xl font-bold text-primary-green mb-12">أرقام وإحصائيات</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                        <div class="p-6 bg-gray-50 rounded-xl shadow-sm hover:shadow-md transition border-b-4 border-accent-gold">
                            <i class="fas fa-industry text-4xl text-primary-green mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800">80%</h3>
                            <p class="text-gray-600">من النشاط الصناعي</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-xl shadow-sm hover:shadow-md transition border-b-4 border-accent-gold">
                            <i class="fas fa-tractor text-4xl text-primary-green mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800">1.8M</h3>
                            <p class="text-gray-600">فدان قابل للزراعة</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-xl shadow-sm hover:shadow-md transition border-b-4 border-accent-gold">
                            <i class="fas fa-city text-4xl text-primary-green mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800">50KM</h3>
                            <p class="text-gray-600">بعد مدينة الجيلي عن المركز</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-xl shadow-sm hover:shadow-md transition border-b-4 border-accent-gold">
                            <i class="fas fa-users text-4xl text-primary-green mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800">400K+</h3>
                            <p class="text-gray-600">فرصة عمل متوقعة</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== MAP PAGE (NEW) ==================== -->
        <section id="map-page" class="page-section bg-white py-8">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-primary-green">
                        <i class="fas fa-map-location-dot ml-2"></i>الخريطة الاستثمارية
                    </h2>
                    <button onclick="navigateTo('home')" class="text-gray-500 hover:text-primary-green">
                        <i class="fas fa-times text-xl"></i> إغلاق الخريطة
                    </button>
                </div>
                <div class="bg-gray-100 p-2 rounded-lg shadow-inner">
                    <div id="map"></div>
                </div>
                <div class="mt-4 text-center text-gray-500 text-sm">
                    انقر على العلامات في الخريطة لعرض الفرص الاستثمارية في كل محلية.
                </div>
            </div>
        </section>

        <!-- ==================== OPPORTUNITIES PAGE (DYNAMIC) ==================== -->
        <section id="opportunities" class="page-section bg-gray-50 py-12">
            <div class="container mx-auto px-4">

                <!-- Search & Filter Header -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 border-r-4 border-primary-green">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-primary-green mb-1" id="opp-page-title">كل الفرص
                                الاستثمارية</h2>
                            <p class="text-gray-500 text-sm" id="opp-count-label">جاري التحميل...</p>
                        </div>
                        <div class="w-full md:w-1/2 relative">
                            <input type="text" id="search-input" onkeyup="filterProjects()"
                                placeholder="ابحث عن اسم مشروع، قطاع، أو محلية..."
                                class="w-full p-3 pr-10 border rounded-lg focus:outline-none focus:border-primary-green focus:ring-1 focus:ring-primary-green">
                            <i class="fas fa-search absolute top-4 right-4 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Projects Grid -->
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="projects-grid">
                    <!-- Cards will be injected here via JavaScript -->
                </div>

                <!-- Empty State -->
                <div id="no-results" class="hidden text-center py-12">
                    <i class="fas fa-folder-open text-gray-300 text-6xl mb-4"></i>
                    <p class="text-gray-500 text-lg">لا توجد مشاريع تطابق بحثك.</p>
                    <button onclick="showAllOpportunities()" class="mt-4 text-primary-green font-bold hover:underline">عرض جميع الفرص</button>
                </div>

            </div>
        </section>

        <!-- ==================== INVESTOR LIBRARY ==================== -->
        <section id="library" class="page-section bg-white py-16">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12" data-aos="fade-up">
                    <h2 class="text-3xl font-bold text-primary-green">مكتبة المستثمر</h2>
                    <div class="w-20 h-1 bg-accent-gold mx-auto mt-4 rounded"></div>
                    <p class="text-gray-600 mt-4">جميع الوثائق والقوانين واللوائح التي يحتاجها المستثمر</p>
                </div>

                <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto">

                    <!-- File 1: Law -->
                    <div
                        class="bg-gray-50 rounded-xl p-6 border border-gray-200 hover:shadow-xl transition transform hover:-translate-y-1 relative group">
                        <div
                            class="absolute top-0 right-0 bg-primary-green text-white text-xs px-3 py-1 rounded-bl-lg rounded-tr-lg">
                            قانون</div>
                        <div class="text-center mb-6 mt-4">
                            <i
                                class="fas fa-gavel text-5xl text-gray-400 group-hover:text-primary-green transition"></i>
                        </div>
                        <h3 class="text-xl font-bold text-center mb-2">قانون الاستثمار 2015</h3>
                        <p class="text-gray-500 text-center text-sm mb-6">تعديل 2018 - يوضح الضمانات والميزات التفضيلية.
                        </p>
                        <div class="flex gap-2">
                            <a href="https://drive.google.com/drive/folders/1oplUaT0hB4jdBLzBp8irGGaBAbEHBCWs?usp=sharing"
                                target="_blank"
                                class="w-full bg-accent-gold text-white py-2 rounded font-bold hover:bg-yellow-600 transition text-center text-sm">
                                <i class="fas fa-download ml-1"></i> تحميل / عرض
                            </a>
                        </div>
                    </div>

                    <!-- File 2: Guide -->
                    <div
                        class="bg-gray-50 rounded-xl p-6 border border-gray-200 hover:shadow-xl transition transform hover:-translate-y-1 relative group">
                        <div
                            class="absolute top-0 right-0 bg-blue-600 text-white text-xs px-3 py-1 rounded-bl-lg rounded-tr-lg">
                            دليل</div>
                        <div class="text-center mb-6 mt-4">
                            <i
                                class="fas fa-book-reader text-5xl text-gray-400 group-hover:text-blue-600 transition"></i>
                        </div>
                        <h3 class="text-xl font-bold text-center mb-2">دليل المستثمر 2015</h3>
                        <p class="text-gray-500 text-center text-sm mb-6">تعرف على مناخ الاستثمار والموارد المتاحة.</p>
                        <div class="flex gap-2">
                            <a href="https://drive.google.com/drive/folders/1oplUaT0hB4jdBLzBp8irGGaBAbEHBCWs?usp=sharing"
                                target="_blank"
                                class="w-full bg-accent-gold text-white py-2 rounded font-bold hover:bg-yellow-600 transition text-center text-sm">
                                <i class="fas fa-download ml-1"></i> تحميل / عرض
                            </a>
                        </div>
                    </div>

                    <!-- File 3: Procedures -->
                    <div
                        class="bg-gray-50 rounded-xl p-6 border border-gray-200 hover:shadow-xl transition transform hover:-translate-y-1 relative group">
                        <div
                            class="absolute top-0 right-0 bg-red-600 text-white text-xs px-3 py-1 rounded-bl-lg rounded-tr-lg">
                            إجراءات</div>
                        <div class="text-center mb-6 mt-4">
                            <i class="fas fa-list-check text-5xl text-gray-400 group-hover:text-red-600 transition"></i>
                        </div>
                        <h3 class="text-xl font-bold text-center mb-2">مرشد الإجراءات 2018</h3>
                        <p class="text-gray-500 text-center text-sm mb-6">خطوات التقديم عبر النافذة الموحدة.</p>
                        <div class="flex gap-2">
                            <a href="https://drive.google.com/drive/folders/1oplUaT0hB4jdBLzBp8irGGaBAbEHBCWs?usp=sharing"
                                target="_blank"
                                class="w-full bg-accent-gold text-white py-2 rounded font-bold hover:bg-yellow-600 transition text-center text-sm">
                                <i class="fas fa-download ml-1"></i> تحميل / عرض
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- ==================== PROCEDURES & LAW & CONTACT ==================== -->
        <section id="procedures" class="page-section bg-gray-50 py-16">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-3xl font-bold text-primary-green">خطوات الاستثمار</h2>
                <p class="mt-4 text-gray-600">للحصول على تفاصيل الخطوات، يرجى تحميل ملف "مرشد الإجراءات" من مكتبة المستثمر.</p>
                <button onclick="navigateTo('library')" class="mt-6 px-6 py-2 border-2 border-primary-green text-primary-green rounded-full hover:bg-primary-green hover:text-white transition">الذهاب للمكتبة</button>
            </div>
        </section>
        <section id="law" class="page-section bg-white py-16">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-3xl font-bold text-primary-green">القوانين واللوائح</h2>
                <p class="mt-4 text-gray-600">للاطلاع على النصوص القانونية الكاملة، يرجى تحميل ملف "قانون الاستثمار" من المكتبة.</p>
                <button onclick="navigateTo('library')" class="mt-6 px-6 py-2 border-2 border-primary-green text-primary-green rounded-full hover:bg-primary-green hover:text-white transition">الذهاب للمكتبة</button>
            </div>
        </section>
        <section id="contact-page" class="page-section bg-white py-16">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-3xl font-bold text-primary-green mb-8">تواصل معنا</h2>
                <div class="bg-gray-100 p-8 rounded-xl max-w-3xl mx-auto shadow-inner">
                    <p class="text-xl mb-4 font-bold text-gray-800">مقر المفوضية</p>
                    <p class="text-gray-600 mb-6">ولاية الخرطوم، السودان</p>
                    <div class="flex flex-col md:flex-row justify-center gap-6">
                        <a href="tel:00249126434639"
                            class="flex items-center justify-center gap-2 bg-white px-6 py-3 rounded shadow hover:text-primary-green transition hover:-translate-y-1">
                            <i class="fas fa-phone"></i> <span dir="ltr">00249 126 434 639</span>
                        </a>
                        <a href="mailto:iec.krt.gov@gmail.com"
                            class="flex items-center justify-center gap-2 bg-white px-6 py-3 rounded shadow hover:text-primary-green transition hover:-translate-y-1">
                            <i class="fas fa-envelope"></i> iec.krt.gov@gmail.com
                        </a>
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-200 flex justify-center gap-6">
                        <a href="https://x.com/IecKrt?s=20" target="_blank" class="text-3xl text-gray-500 hover:text-black transition transform hover:scale-110">
                            <i class="fa-brands fa-x-twitter"></i>
                        </a>
                        <a href="https://www.facebook.com/share/1N8BAEJ3fM/" target="_blank" class="text-3xl text-gray-500 hover:text-blue-600 transition transform hover:scale-110">
                            <i class="fab fa-facebook"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modal for Project Details -->
    <div id="project-modal"
        class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-60 backdrop-blur-sm" onclick="closeModal()"></div>

        <div
            class="modal-container bg-white w-11/12 md:max-w-2xl mx-auto rounded-xl shadow-2xl z-50 overflow-y-auto max-h-[90vh] animate-slide-up transform transition-all">

            <div class="modal-close absolute top-2 right-2 cursor-pointer flex flex-col items-center p-2 bg-black/20 rounded-full hover:bg-black/40 transition z-50"
                onclick="closeModal()">
                <svg class="fill-current text-white" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                    viewBox="0 0 18 18">
                    <path
                        d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
                    </path>
                </svg>
            </div>

            <!-- Modal Content -->
            <div class="modal-content text-right relative">
                <!-- Header Image -->
                <div class="h-56 w-full relative">
                    <img id="modal-img" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    <div class="absolute bottom-4 right-4 text-white">
                         <span class="bg-accent-gold text-white px-3 py-1 rounded text-xs font-bold mb-1 inline-block"
                        id="modal-category">
                        <!-- Category -->
                        </span>
                        <h2 class="text-2xl font-bold leading-tight" id="modal-title">عنوان المشروع</h2>
                    </div>
                </div>

                <div class="py-6 px-8">
                    <div class="flex items-center text-gray-600 mb-6 bg-gray-50 p-3 rounded-lg">
                        <i class="fas fa-map-marker-alt ml-2 text-primary-green text-xl"></i>
                        <div>
                             <span class="text-xs text-gray-400 block">الموقع المقترح</span>
                             <span id="modal-loc" class="font-bold text-gray-800">الموقع</span>
                        </div>
                    </div>

                    <h3 class="font-bold text-lg text-primary-green mb-3 border-b pb-2">تفاصيل الفرصة الاستثمارية</h3>
                    <p class="text-gray-600 leading-loose mb-8 text-lg whitespace-pre-line" id="modal-desc">
                        وصف تفصيلي للمشروع...
                    </p>

                    <div class="flex justify-between items-center pt-4 border-t">
                        <button onclick="closeModal()"
                            class="px-6 py-2 bg-gray-100 rounded-lg text-gray-600 hover:bg-gray-200 transition">إغلاق</button>
                        <a href="mailto:iec.krt.gov@gmail.com"
                            class="px-6 py-2 bg-primary-green rounded-lg text-white hover:bg-green-700 transition shadow flex items-center gap-2">
                            <i class="fas fa-paper-plane"></i> قدم اهتمامك
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark-gray text-white pt-12 pb-6 border-t-4 border-accent-gold mt-auto relative overflow-hidden">
        <div class="container mx-auto px-4 relative z-10">
            <div class="grid md:grid-cols-3 gap-8 text-center md:text-right mb-8">
                <div>
                     <h4 class="text-xl font-bold text-accent-gold mb-4">عن المفوضية</h4>
                     <p class="text-gray-400 text-sm leading-relaxed">نسعى لخلق بيئة استثمارية جاذبة ومستدامة في ولاية الخرطوم من خلال تبسيط الإجراءات وتوفير المعلومات الدقيقة.</p>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-accent-gold mb-4">روابط سريعة</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li><a href="#" onclick="navigateTo('home')" class="hover:text-white transition">الرئيسية</a></li>
                        <li><a href="#" onclick="navigateTo('opportunities')" class="hover:text-white transition">الفرص الاستثمارية</a></li>
                        <li><a href="#" onclick="navigateTo('map-page')" class="hover:text-white transition">الخريطة التفاعلية</a></li>
                        <li><a href="#" onclick="navigateTo('library')" class="hover:text-white transition">مكتبة المستثمر</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-accent-gold mb-4">تواصل معنا</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li><i class="fas fa-phone ml-2"></i> 00249126434639</li>
                        <li><i class="fas fa-envelope ml-2"></i> iec.krt.gov@gmail.com</li>
                        <li class="flex gap-4 mt-2 justify-center md:justify-start">
                            <a href="https://x.com/IecKrt?s=20" class="hover:text-white"><i class="fa-brands fa-x-twitter text-lg"></i></a>
                            <a href="https://www.facebook.com/share/1N8BAEJ3fM/" class="hover:text-white"><i class="fab fa-facebook text-lg"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-6 text-center">
                <p class="text-xs text-gray-500">&copy; 2025 مفوضية تشجيع الاستثمار - ولاية الخرطوم. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        AOS.init({ duration: 800, once: true });

        /* Global Vars */
        let map; // Leaflet map instance
        let allProjects = [];

        /* DATA STRUCTURE */
        const db = {
            sectors: {
                "القطاع الزراعي": [
                    { title: "مشروع مجمعات البيوت المحمية", loc: "متعدد", desc: "إنتاج الخضروات في غير مواسمها لتحقيق الاكتفاء الذاتي ورفع كفاءة استخدام المياه." },
                    { title: "مشروع الري المحوري لإنتاج الأعلاف", loc: "متعدد", desc: "زراعة الأعلاف مثل البرسيم والذرة الشامية باستخدام الري المحوري لتوفير احتياجات الثروة الحيوانية." },
                    { title: "مشروعات انتاج النباتات الطبية والعطرية والتوابل", loc: "الريف الشمالي", desc: "زراعة وتجهيز النباتات الطبية والعطرية مثل الكركديه والسنمكة والتوابل للتصدير والصناعات الدوائية." },
                    { title: "مشروع انتاج الزيوت العطرية", loc: "صناعي/زراعي", desc: "استخلاص الزيوت العطرية من النباتات الطبية والعطرية للاستخدام في الصناعات الدوائية والتجميلية والغذائية." },
                    { title: "مشروعات انتاج الدهون النباتية", loc: "صناعي/زراعي", desc: "تصنيع الدهون والزيوت النباتية من المحاصيل الزيتية ضمن الصناعات الغذائية." },
                    { title: "مشروعات صناعة منتجات الألبان المختلفة", loc: "متعدد", desc: "إنشاء مزارع إنتاج الألبان ومصانع لتصنيع الألبان ومنتجاتها وتطوير سلسلة التبريد والنقل من المزرعة للمصنع." },
                    { title: "مشروعات صناعة منتجات الأسماك", loc: "جبل أولياء", desc: "تصنيع وتعليب منتجات الأسماك وإنتاج أعلاف الأسماك والتجهيز للتسويق والصادر." },
                    { title: "مشروعات الصناعات الصغيرة في قطاع الجلود", loc: "متعدد", desc: "ورش وصناعات صغيرة في مجال الجلود تشمل تجهيز الجلود وتصنيع المنتجات الجلدية المختلفة." },
                    { title: "مشروعات صناعة الأسمدة العضوية من المخلفات", loc: "متعدد", desc: "إنتاج أسمدة عضوية من المخلفات الزراعية والحيوانية لتحسين خصوبة التربة وتقليل التلوث." },
                    { title: "مشروعات صناعة تجفيف الخضر والفاكهة", loc: "متعدد", desc: "تجفيف الخضروات والفاكهة لزيادة فترة التخزين وإضافة قيمة مضافة للصادر والأسواق المحلية." },
                    { title: "تربية وإنتاج الضأن والماعز", loc: "ريف/رعوي", desc: "مشروعات لتربية الضأن والماعز وتحسين الإنتاجية لتلبية احتياجات السوق والصادر." },
                    { title: "تربية وتسمين الإبل", loc: "ريف/رعوي", desc: "تربية وتسمين الإبل لإنتاج اللحوم ومنتجات مرتبطة بالصادر والأسواق المحلية." },
                    { title: "إنشاء مجمعات لتسمين الأغنام والعجول", loc: "متعدد", desc: "مجمعات متخصصة لتسمين الأغنام والعجول لزيادة إنتاج اللحوم الحمراء بجودة مناسبة للصادر." },
                    { title: "الاستثمار في مجال تحسين النسل والخدمات البيطرية", loc: "متعدد", desc: "تطوير برامج تحسين النسل وخدمات بيطرية متقدمة لدعم الإنتاج الحيواني." },
                    { title: "تأهيل المسالخ القائمة وإنشاء مسالخ جديدة", loc: "متعدد", desc: "تأهيل المسالخ وإدخال تكنولوجيا حديثة وإنشاء مسالخ جديدة وفق متطلبات الصحة والصادر." },
                    { title: "الاستثمار في المجالات المساندة للإنتاج والتسويق", loc: "متعدد", desc: "مشروعات للنقل من مناطق الإنتاج، والمخازن المبردة، والتخزين والخدمات اللوجستية." },
                    { title: "مشروعات جمع وتصنيع وتسويق اللحوم الحمراء", loc: "متعدد", desc: "سلاسل متكاملة لجمع وتصنيع وتسويق اللحوم الحمراء ومنتجاتها." },
                    { title: "مشروعات إنتاج وتصنيع الأعلاف", loc: "متعدد", desc: "إنتاج وتصنيع الأعلاف المركزة والحيوانية لتغطية احتياجات قطاعات الإنتاج الحيواني." },
                    { title: "إنشاء مزارع جدود الدجاج اللاحم", loc: "متعدد", desc: "توفير احتياجات مزارع أمهات الدجاج اللاحم من الصيصان لدعم صناعة لحوم الدواجن." },
                    { title: "التوسع في مزارع أمهات الدجاج اللاحم", loc: "متعدد", desc: "التوسع في إنشاء مزارع أمهات الدجاج اللاحم لتأمين الصيصان للمزارع اللاحمة مستقبلًا." },
                    { title: "الاستثمار في مشروعات بيض المائدة", loc: "متعدد", desc: "إنشاء مزارع لإنتاج بيض المائدة لتغطية الطلب المحلي والصادرات المحتملة." },
                    { title: "الاستثمار في الأعلاف المصنعة محليًا والمستوردة", loc: "متعدد", desc: "تطوير صناعة الأعلاف المصنعة محليًا واستيراد مكملات أعلاف لتلبية احتياجات مزارع الدواجن." }
                ],
                "قطاع التعليم (خدمي)": [
                    { title: "مدارس خاصة بمناهج مزدوجة (محلية ودولية)", loc: "الخرطوم", desc: "مدارس خاصة تقدم مناهج محلية ودولية حديثة مثل STEM وبرامج عالمية أخرى." },
                    { title: "جامعات أو كليات أو معاهد تقنية متخصصة", loc: "الخرطوم", desc: "مؤسسات تعليم عالي ومعاهد تقنية متخصصة في المجالات الهندسية والتقنية والتطبيقية." },
                    { title: "مراكز الحرفيين الصغار للإنتاج الجماعي", loc: "متعدد", desc: "مراكز تدريب وإنتاج جماعي للحرفيين الصغار خاصة في المنتجات الجلدية والحرفية." }
                ],
                "قطاع السياحة (خدمي)": [
                    { title: "منتجعات واستراحات ريفية أو جبلية", loc: "أطراف الولاية", desc: "منتجعات واستراحات ريفية وجبلية تقدم خدمات سياحة ترفيهية وطبيعية." },
                    { title: "الاستثمار في السياحة البيئية أو الاستشفائية", loc: "متعدد", desc: "منتجعات علاجية وبيئية تعتمد على الموارد الطبيعية والخدمات الصحية المساندة." },
                    { title: "شركات سياحة داخلية منظمة", loc: "الخرطوم", desc: "شركات وخدمات لتنظيم الرحلات الداخلية السياحية والثقافية." },
                    { title: "رحلات تاريخية وثقافية للمواطنين والمقيمين", loc: "الخرطوم/أم درمان", desc: "برامج سياحة تاريخية وثقافية للتعريف بالتراث والمعالم التاريخية." },
                    { title: "خدمات النقل السياحي", loc: "متعدد", desc: "بصات وعربات سياحية مجهزة لنقل السياح بين المواقع المختلفة." },
                    { title: "الاستثمار في النزل الاقتصادية أو البيوت التراثية", loc: "أم درمان", desc: "نزل اقتصادية وبيوت تراثية تقدم تجربة سكن تراثي وسياحة ثقافية." }
                ],
                "قطاع الصحة (خدمي)": [
                    { title: "مستشفيات متخصصة", loc: "الخرطوم", desc: "مستشفيات متخصصة في السكري، العلاج الطبيعي وإعادة التأهيل، الأمراض الجلدية، وطب الأسنان." }
                ]
            },
            localities: {
                "محلية الخرطوم": [
                    { title: "سياحة وترفيه ( منتجعات نيلية – فنادق 5 و 7 نجوم – مطاعم عائمة )", loc: "الخرطوم", desc: "منتجعات نيلية – فنادق 5 و 7 نجوم – مطاعم ومطاعم عائمة على النيل." },
                    { title: "مشروعات إسكان ( إسكان اقتصادي – مجمعات تجارية – توسع عمراني – مدن ذكية)", loc: "الخرطوم", desc: "إسكان اقتصادي – مجمعات تجارية – توسع عمراني – مدن ذكية." },
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "الخرطوم", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "الخرطوم", desc: "مسالخ حديثة بنظم جودة معتمدة عالمياً مع متطلبات صادر اللحوم." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "الخرطوم", desc: "مسابك وورش وحدادة وسمكرة وصناعات خشبية وجلدية وصناعة منتجات التريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "الخرطوم", desc: "مشاتل لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ],
                "محلية جبل أولياء": [
                    { title: "الاستثمار في تطوير انتاج الأسماك", loc: "جبل أولياء", desc: "تطوير انتاج الأسماك وتصنيع منتجاتها." },
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "جبل أولياء", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "جبل أولياء", desc: "مسالخ حديثة بنظم جودة معتمدة عالمياً مع متطلبات صادر اللحوم." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "جبل أولياء", desc: "مسابك وورش وحدادة وسمكرة وصناعات خشبية وجلدية وصناعة منتجات التريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "جبل أولياء", desc: "مشاتل لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ],
                "محلية أم درمان": [
                    { title: "صناعات صغيرة ( مسابك – ورش – مشاتل )", loc: "أم درمان", desc: "مسابك وورش صغيرة بالإضافة لمشاتل." },
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "أم درمان", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "أم درمان", desc: "مسالخ حديثة بنظم جودة معتمدة عالمياً مع متطلبات صادر اللحوم." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "أم درمان", desc: "مسابك وورش وحدادة وسمكرة وصناعات خشبية وجلدية وصناعة منتجات التريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "أم درمان", desc: "مشاتل لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ],
                "محلية أمبدة": [
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "أمبدة", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "أمبدة", desc: "مسالخ حديثة بنظم جودة معتمدة عالمياً مع متطلبات صادر اللحوم." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "أمبدة", desc: "مسابك وورش وحدادة وسمكرة وصناعات خشبية وجلدية وصناعة منتجات التريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "أمبدة", desc: "مشاتل لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ],
                "محلية كرري": [
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "كرري", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "كرري", desc: "مسالخ حديثة بنظم جودة معتمدة عالمياً مع متطلبات صادر اللحوم." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "كرري", desc: "مسابك وورش وحدادة وسمكرة وصناعات خشبية وجلدية وصناعة منتجات التريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "كرري", desc: "مشاتل لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ],
                "محلية بحري": [
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "بحري", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "بحري", desc: "مسالخ حديثة بنظم جودة معتمدة عالمياً مع متطلبات صادر اللحوم." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "بحري", desc: "مسابك وورش وحدادة وسمكرة وصناعات خشبية وجلدية وصناعة منتجات التريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "بحري", desc: "مشاتل لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ],
                "محلية شرق النيل": [
                    { title: "انتاج الدقيق المخلوط والمخبوزات", loc: "شرق النيل", desc: "انتاج الدقيق المخلوط وصناعة المعجنات والمخبوزات والوجبات السريعة ومخابز حديثة." },
                    { title: "تطوير المساطب الي مسالخ حديثة", loc: "شرق النيل", desc: "مسالخ حديثة للصادر بنظم جودة معتمدة عالمياً." },
                    { title: "صناعات صغيرة ( مسابك – ورش – حدادة وسمكرة - صناعات خشبية - صناعات جلدية - منتجات التريكو )", loc: "شرق النيل", desc: "منطقة حرفية لصناعات صغيرة تشمل المسابك والورش والحدادة والسمكرة والصناعات الخشبية والجلدية والتريكو." },
                    { title: "مشاتل انتاج نباتات الزينة والفاكهة والخضروات", loc: "شرق النيل", desc: "مشاتل وبساتين وتشجير لإنتاج نباتات الزينة والفاكهة والخضروات." }
                ]
            },
            commission: {
                "المفوضية": [
                    { title: "مشروع تطوير مدينة الجيلي الصناعية", loc: "شمال بحري (الجيلي)", desc: "يمثل هذا المشروع أكبر مدينة صناعية في البلاد ويُعتبر المرتكز الأساسي لتنفيذ حزمة المشروعات الاستراتيجية.\nالموقع: الجزء الشمالي من ولاية الخرطوم، على بُعد 50 كيلومترًا من العاصمة.\nالأهداف: استيعاب نقل بعض الصناعات، وزيادة مساهمة القطاع الصناعي في الاقتصاد.", tag: "استراتيجي" },
                    { title: "مشروع تطوير مدينة الصناعات الجلدية", loc: "مدينة الجيلي الصناعية", desc: "تطوير وتوطين الصناعات الجلدية والمدابغ ضمن منطقة متخصصة داخل مدينة الجيلي الصناعية.\nالأهداف: زيادة الطاقة الإنتاجية للدباغة وتحسين صناعة الأحذية الجلدية.", tag: "صناعي" },
                    { title: "مدينة سكنية للعاملين بمدينة الجيلي الصناعية", loc: "حول مدينة الجيلي", desc: "إنشاء مدينة سكنية–صناعية متكاملة تضم مناطق صناعية وأحياء سكنية للعاملين ومرافق خدمية.", tag: "عمراني" },
                    { title: "مشروع إنشاء محطة طاقة شمسية", loc: "ولاية الخرطوم", desc: "زيادة إنتاج البلاد وتنويع مصادر الطاقة عبر استغلال الإشعاع الشمسي المرتفع في السودان.", tag: "طاقة" },
                    { title: "مشروع المنظومة المتكاملة للثروة الحيوانية", loc: "غرب أم درمان", desc: "إنشاء وتشغيل منظومة متكاملة للثروة الحيوانية تشمل مواقع إنتاجية وخدمية مساندة تلبي المتطلبات المحلية والعالمية.", tag: "زراعي/حيواني" },
                    { title: "مشروعات تطوير الإنتاج الريفي", loc: "ريف ولاية الخرطوم", desc: "زيادة الإنتاج والإنتاجية، وتنمية الريف، وتوفير فرص العمل مع استهداف الجمعيات التعاونية.", tag: "زراعي/تنموي" },
                    { title: "مشروعات الطرق والجسور والكباري الطائرة", loc: "مواقع مختلفة", desc: "تسهيل حركة السكان والتجارة وفك الاختناقات المرورية وتحسين كفاءة النقل.", tag: "بنية تحتية" },
                    { title: "مشروعات إنشاء وتأهيل طرق", loc: "طرق إقليمية وحضرية", desc: "تحسين البنية التحتية للطرق وزيادة كفاءة النقل وتقليل الحوادث واستهلاك الوقود.", tag: "بنية تحتية" },
                    { title: "مشروعات تطوير الواجهات النيلية", loc: "ضفاف النيل", desc: "إنشاء وتطوير واجهة نيلية سياحية ترفيهية تشمل ممشى ومناطق جلوس وخدمات.", tag: "سياحي" },
                    { title: "مشروعات إنشاء محطتي مياه", loc: "مناطق متجاورة", desc: "إنشاء محطتي مياه متكاملتين لمعالجة مياه الشرب أو الضخ والتوزيع.", tag: "مياه" },
                    { title: "مشروعات المياه والصرف الصحي والسطحي", loc: "أم درمان ومناطق صناعية", desc: "معالجة الفجوات الخدمية في مجالات مياه الشرب والصرف الصحي والصرف السطحي.", tag: "خدمات حضرية" },
                    { title: "مشروع سلسلة اللحوم", loc: "منطقة زراعية/رعوية", desc: "سلسلة متكاملة لتسمين الماشية وزراعة الأعلاف وتجهيز اللحوم الحمراء.", tag: "زراعي/حيواني" },
                    { title: "مشروع تصنيع الأسمدة العضوية", loc: "بالقرب من مشاريع زراعية", desc: "إنشاء منشأة متخصصة في إنتاج الأسمدة العضوية من المخلفات الزراعية وروث الحيوانات.", tag: "صناعي/زراعي" },
                    { title: "مشروع الصمغ العربي", loc: "ولاية الخرطوم", desc: "إنتاج وتجهيز الصمغ العربي لتغطية الطلب المحلي والعالمي.", tag: "زراعي/تصديري" },
                    { title: "النفايات استثمار مضمون", loc: "ولاية الخرطوم", desc: "مشروعات إعادة التدوير المختلفة لتحقيق فوائد بيئية واقتصادية واجتماعية.", tag: "بيئي/صناعي" },
                    { title: "مشروع تدوير الإطارات التالفة", loc: "ولاية الخرطوم", desc: "إعادة تدوير الإطارات المستعملة والتالفة لإنتاج البلاط المطاطي ومنتجات أخرى.", tag: "بيئي/صناعي" },
                    { title: "مستشفى سياحة علاجية", loc: "ولاية الخرطوم", desc: "إنشاء مستشفى حديث للسياحة العلاجية يوفر تميزًا في التشخيص الطبي والسريري.", tag: "صحي/استثماري" },
                    { title: "مشروع مستشفى أمراض قلب", loc: "ولاية الخرطوم", desc: "إنشاء مستشفى متخصص في أمراض القلب يقدم خدمات تشخيصية وعلاجية وجراحية متقدمة.", tag: "صحي/متخصص" },
                    { title: "مشروع إنشاء مركز فني تقني", loc: "منطقة حضرية", desc: "إنشاء مركز فني تقني يقدم برامج تدريب مهني وتقني في مجالات متعددة.", tag: "تعليمي/تدريبي" }
                ]
            }
        };

        // Coordinates Mapping for Map
        const localityCoords = {
            "محلية الخرطوم": [15.5517, 32.5323],
            "محلية جبل أولياء": [15.2447, 32.5312],
            "محلية أم درمان": [15.6445, 32.4777],
            "محلية أمبدة": [15.6333, 32.4167],
            "محلية كرري": [15.7500, 32.4500],
            "محلية شرق النيل": [15.6167, 32.6500],
            "محلية بحري": [15.6133, 32.5385]
        };

        // --- Custom Image Library (Sudanese/African Context) ---
        const imageLibrary = {
            // Agriculture
            "greenhouse": "https://images.unsplash.com/photo-1585314062340-f1a5a7c9328d?auto=format&fit=crop&w=800&q=80", // Greenhouses
            "pivot": "https://images.unsplash.com/photo-1473649085228-583485e6e4d7?auto=format&fit=crop&w=800&q=80", // Aerial pivot irrigation
            "farming": "https://images.unsplash.com/photo-1592982537447-6d2a696497d5?auto=format&fit=crop&w=800&q=80", // General farming
            "gum_arabic": "https://images.unsplash.com/photo-1518182170546-07fb66c65548?auto=format&fit=crop&w=800&q=80", // Acacia/Gum Arabic tree

            // Livestock
            "cattle": "https://images.unsplash.com/photo-1598927060377-17f14c274488?auto=format&fit=crop&w=800&q=80", // Cows in field
            "camels": "https://images.unsplash.com/photo-1550604598-637953289947?auto=format&fit=crop&w=800&q=80", // Camels desert
            "sheep": "https://images.unsplash.com/photo-1484557985045-edf25e08da73?auto=format&fit=crop&w=800&q=80", // Sheep
            "poultry": "https://images.unsplash.com/photo-1545228691-1055743d526f?auto=format&fit=crop&w=800&q=80", // Poultry

            // Nile & Water
            "nile": "https://images.unsplash.com/photo-1547942704-58079a0b17b2?auto=format&fit=crop&w=800&q=80", // River boat/Nile
            "fish": "https://images.unsplash.com/photo-1521665809798-2323cc2f6672?auto=format&fit=crop&w=800&q=80", // Fishing/Net

            // Industry & Infrastructure
            "factory": "https://images.unsplash.com/photo-1565514020176-db93781d4a8d?auto=format&fit=crop&w=800&q=80", // Generic Factory
            "leather": "https://images.unsplash.com/photo-1605636035889-72df54ee38eb?auto=format&fit=crop&w=800&q=80", // Leather work
            "solar": "https://images.unsplash.com/photo-1509391366360-2e959784a276?auto=format&fit=crop&w=800&q=80", // Solar Panels Desert
            "road": "https://images.unsplash.com/photo-1469334031218-e382a71b716b?auto=format&fit=crop&w=800&q=80", // Desert Road
            "bridge": "https://images.unsplash.com/photo-1545558014-8692077e9b5c?auto=format&fit=crop&w=800&q=80", // Bridge

            // Services
            "hospital": "https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?auto=format&fit=crop&w=800&q=80", // Modern Hospital
            "education": "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=800&q=80", // Education/School
            "hotel": "https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&w=800&q=80", // Luxury Hotel
            
            // Localities/City
            "khartoum": "https://images.unsplash.com/photo-1580126781297-c81729b13903?auto=format&fit=crop&w=800&q=80", // Cityscape
            "market": "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?auto=format&fit=crop&w=800&q=80", // Market
        };

        // --- Helper: Get Image based on Title/Category ---
        function getProjectImage(title, category) {
            const t = title.toLowerCase();
            const c = category ? category.toLowerCase() : "";

            // 1. Specific Projects (High Priority)
            if (t.includes('جيلي') && t.includes('صناعية')) return imageLibrary.factory;
            if (t.includes('جلدية')) return imageLibrary.leather;
            if (t.includes('محطة طاقة شمسية')) return imageLibrary.solar;
            if (t.includes('بيوت محمية')) return imageLibrary.greenhouse;
            if (t.includes('ري محوري')) return imageLibrary.pivot;
            if (t.includes('صمغ عربي')) return imageLibrary.gum_arabic;
            if (t.includes('سلسلة اللحوم') || t.includes('مسلخ')) return imageLibrary.cattle;
            if (t.includes('واجهات نيلية') || t.includes('سياحة وترفيه')) return imageLibrary.nile;
            if (t.includes('طرق وجسور') || t.includes('كباري')) return imageLibrary.bridge;

            // 2. Localities Specifics
            if (t.includes('محلية الخرطوم')) return imageLibrary.khartoum;
            if (t.includes('محلية جبل أولياء') || t.includes('أسماك')) return imageLibrary.fish;
            if (t.includes('شرق النيل') && t.includes('بساتين')) return imageLibrary.farming;

            // 3. Category Fallbacks
            if (t.includes('زراعة') || t.includes('محاصيل') || t.includes('أعلاف') || t.includes('نباتات')) return imageLibrary.farming;
            if (t.includes('حيوان') || t.includes('عجول') || t.includes('لحوم') || t.includes('مسالخ')) return imageLibrary.cattle;
            if (t.includes('إبل')) return imageLibrary.camels;
            if (t.includes('ضأن') || t.includes('ماعز')) return imageLibrary.sheep;
            if (t.includes('دواجن') || t.includes('بيض')) return imageLibrary.poultry;
            
            if (t.includes('صناعة') || t.includes('مصنع') || t.includes('ورش') || t.includes('مسابك')) return imageLibrary.factory;
            if (t.includes('دقيق') || t.includes('مخبوزات')) return "https://images.unsplash.com/photo-1509440159596-0249088772ff?auto=format&fit=crop&w=800&q=80";
            
            if (t.includes('مستشفى') || t.includes('طبي') || t.includes('علاج')) return imageLibrary.hospital;
            if (t.includes('تعليم') || t.includes('مدارس') || t.includes('جامعات') || t.includes('تدريب')) return imageLibrary.education;
            if (t.includes('سياح') || t.includes('فنادق') || t.includes('منتجعات') || t.includes('نزل')) return imageLibrary.hotel;
            
            if (t.includes('بناء') || t.includes('عقار') || t.includes('سكن') || t.includes('مدن ذكية')) return "https://images.unsplash.com/photo-1503387762-592deb58ef4e?auto=format&fit=crop&w=800&q=80";

            return "https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=800&q=80"; // Generic Business
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeMenus();
            loadAllProjectsFlattened();

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('filter')) {
                const filterVal = urlParams.get('filter');
                const typeVal = urlParams.get('type');
                filterProjects(filterVal, typeVal);
                document.getElementById('opportunities').scrollIntoView();
            }
        });

        // --- Logic: Prepare Menus ---
        function initializeMenus() {
            const containers = {
                sectors: document.getElementById('nav-sectors-container'),
                localities: document.getElementById('nav-localities-container'),
                commission: document.getElementById('nav-commission-container')
            };

            const mobileLists = {
                sectors: document.getElementById('mobile-sectors-list'),
                localities: document.getElementById('mobile-localities-list'),
                commission: document.getElementById('mobile-commission-list')
            };

            const createLink = (text, filterType) => {
                const btn = document.createElement('button');
                btn.className = "block w-full text-right px-4 py-3 text-sm text-gray-700 hover:bg-green-50 hover:text-primary-green border-b border-gray-100 last:border-0 transition duration-150";
                btn.innerHTML = `<i class="fas fa-angle-left ml-2 text-gray-300 text-xs"></i> ${text}`;
                btn.onclick = () => {
                    navigateTo('opportunities');
                    filterProjects(text, filterType);
                    toggleMobileMenu(false);
                };
                return btn;
            };

            const createMobileLink = (text, filterType) => {
                 const btn = document.createElement('button');
                 btn.className = "block w-full text-right px-2 py-1 text-gray-600 hover:text-primary-green text-sm";
                 btn.innerText = text;
                 btn.onclick = () => {
                    navigateTo('opportunities');
                    filterProjects(text, filterType);
                    toggleMobileMenu(false);
                 };
                 return btn;
            }

            // 1. Populate Sectors
            Object.keys(db.sectors).forEach(key => {
                containers.sectors.appendChild(createLink(key, 'sector'));
                mobileLists.sectors.appendChild(createMobileLink(key, 'sector'));
            });

            // 2. Populate Localities (With Map Link First)
            
            // Add Map Link Button to Desktop Dropdown
            const mapBtn = document.createElement('button');
            mapBtn.className = "block w-full text-right px-4 py-3 text-sm font-bold text-accent-gold hover:bg-green-50 border-b border-accent-gold transition duration-150";
            mapBtn.innerHTML = `<i class="fas fa-map-marked-alt ml-2"></i> الخريطة التفاعلية`;
            mapBtn.onclick = () => {
                navigateTo('map-page');
            };
            containers.localities.appendChild(mapBtn);

            Object.keys(db.localities).forEach(key => {
                containers.localities.appendChild(createLink(key, 'locality'));
                mobileLists.localities.appendChild(createMobileLink(key, 'locality'));
            });

            // 3. Populate Commission
            Object.keys(db.commission).forEach(key => {
                containers.commission.appendChild(createLink(key, 'commission'));
                mobileLists.commission.appendChild(createMobileLink(key, 'commission'));
            });
        }

        function loadAllProjectsFlattened() {
            allProjects = [];
            Object.entries(db.sectors).forEach(([category, items]) => items.forEach(item => allProjects.push({ ...item, category, type: 'sector' })));
            Object.entries(db.localities).forEach(([category, items]) => items.forEach(item => allProjects.push({ ...item, category, type: 'locality' })));
            Object.entries(db.commission).forEach(([category, items]) => items.forEach(item => allProjects.push({ ...item, category, type: 'commission' })));
            renderProjects(allProjects);
            document.getElementById('opp-count-label').textContent = `${allProjects.length} فرصة متاحة`;
        }

        function renderProjects(projects) {
            const grid = document.getElementById('projects-grid');
            const noResults = document.getElementById('no-results');
            grid.innerHTML = '';

            if (projects.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                
                projects.forEach((proj, index) => {
                    const imgSrc = getProjectImage(proj.title, proj.category);
                    const isCommission = proj.type === 'commission';
                    const badgeColor = isCommission ? 'bg-accent-gold' : 'bg-primary-green';

                    const card = document.createElement('div');
                    card.className = `bg-white rounded-lg shadow-md hover:shadow-2xl transition duration-300 overflow-hidden flex flex-col border border-t-4 ${isCommission ? 'border-t-accent-gold' : 'border-t-transparent'}`;
                    card.setAttribute('data-aos', 'fade-up');
                    card.setAttribute('data-aos-delay', (index % 5) * 100);

                    card.innerHTML = `
                        <div class="h-48 overflow-hidden relative group cursor-pointer" onclick="openModal('${proj.title}')">
                            <img src="${imgSrc}" alt="${proj.title}" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500">
                            <div class="absolute top-2 right-2 ${badgeColor} text-white text-xs px-2 py-1 rounded shadow">
                                ${proj.category}
                            </div>
                        </div>
                        <div class="p-5 flex-grow flex flex-col">
                            <h3 class="text-lg font-bold text-gray-800 mb-2 leading-tight">${proj.title}</h3>
                            <div class="text-sm text-gray-500 mb-3 flex items-center">
                                <i class="fas fa-map-marker-alt text-primary-green ml-1"></i> ${proj.loc}
                            </div>
                            <p class="text-gray-600 text-sm mb-4 line-clamp-2">${proj.desc.split('\n')[0]}</p>
                            <button onclick="openModal('${proj.title}')" class="mt-auto w-full border border-primary-green text-primary-green py-2 rounded hover:bg-primary-green hover:text-white transition font-medium">
                                التفاصيل
                            </button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        function filterProjects(keyword = '', type = null) {
            let inputVal = keyword;
            if(!inputVal) inputVal = document.getElementById('search-input').value;
            
            const term = inputVal.toLowerCase();

            const filtered = allProjects.filter(p => {
                const matchesSearch = p.title.toLowerCase().includes(term) || p.category.toLowerCase().includes(term) || p.loc.toLowerCase().includes(term);
                const matchesType = type ? p.type === type || p.category === keyword : true;
                return matchesSearch && matchesType;
            });

            if(keyword && type) {
                document.getElementById('opp-page-title').textContent = `نتائج البحث: ${keyword}`;
                if(keyword !== document.getElementById('search-input').value) document.getElementById('search-input').value = '';
            } else if (!term) {
                document.getElementById('opp-page-title').textContent = "كل الفرص الاستثمارية";
            }

            document.getElementById('opp-count-label').textContent = `${filtered.length} فرصة`;
            renderProjects(filtered);
        }

        function showAllOpportunities() {
            navigateTo('opportunities');
            document.getElementById('search-input').value = '';
            filterProjects('');
        }

        /* --- Map Functions --- */
        function initMap() {
            if (map) return; // Prevent re-initialization

            // Center on Khartoum
            map = L.map('map').setView([15.6366, 32.5283], 11);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Add Markers
            Object.keys(db.localities).forEach(locName => {
                const coords = localityCoords[locName];
                if (coords) {
                    const opportunities = db.localities[locName];
                    let listHtml = "<ul class='mt-2'>";
                    opportunities.forEach(item => {
                        listHtml += `<li class='mb-1 border-b pb-1 last:border-0'>${item.title}</li>`;
                    });
                    listHtml += "</ul>";

                    const popupContent = `
                        <div class="popup-content">
                            <div class="popup-title">${locName}</div>
                            <div class="max-h-40 overflow-y-auto custom-scroll p-2">
                                ${listHtml}
                            </div>
                            <button onclick="navigateTo('opportunities'); filterProjects('${locName}', 'locality')" 
                                class="mt-2 w-full bg-accent-gold text-white text-xs py-1 rounded hover:bg-yellow-600">
                                عرض التفاصيل الكاملة
                            </button>
                        </div>
                    `;

                    L.marker(coords).addTo(map).bindPopup(popupContent);
                }
            });
        }

        function navigateTo(sectionId) {
            document.querySelectorAll('.page-section').forEach(sec => sec.classList.remove('active'));
            const target = document.getElementById(sectionId);
            if(target) {
                target.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Initialize/Resize map if navigating to map page
                if (sectionId === 'map-page') {
                    setTimeout(() => {
                        initMap();
                        if(map) map.invalidateSize();
                    }, 200);
                }
            }
            toggleMobileMenu(false);
        }

        function toggleMobileMenu(forceState) {
            const menu = document.getElementById('mobile-menu');
            if (forceState !== undefined) {
                if (forceState) menu.classList.remove('hidden');
                else menu.classList.add('hidden');
            } else {
                menu.classList.toggle('hidden');
            }
        }

        function openModal(projectTitle) {
            const project = allProjects.find(p => p.title === projectTitle);
            if (!project) return;
            document.getElementById('modal-title').innerText = project.title;
            document.getElementById('modal-desc').innerText = project.desc;
            document.getElementById('modal-loc').innerText = project.loc;
            document.getElementById('modal-category').innerText = project.category;
            document.getElementById('modal-img').src = getProjectImage(project.title, project.category);
            const modal = document.getElementById('project-modal');
            modal.classList.remove('opacity-0', 'pointer-events-none');
            document.body.classList.add('modal-active');
        }

        function closeModal() {
            const modal = document.getElementById('project-modal');
            modal.classList.add('opacity-0', 'pointer-events-none');
            document.body.classList.remove('modal-active');
        }

        window.addEventListener('scroll', () => {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) {
                header.classList.add('top-0');
                header.classList.remove('md:top-9');
            } else {
                header.classList.remove('top-0');
                header.classList.add('md:top-9');
            }
        });

    </script>
</body>

</html>